<style>

body {background-color: #11111b; color: #cdd6f4}
.-variable-parameter {color: #eba0ac}
.-constructor-lua {color: #f2cdcd}
.-keyword-function {color: #cba6f7}
.Keyword {color: #cba6f7}
.-constant-builtin {color: #fab387}
.Constant {color: #fab387}
.Label {color: #74c7ec}
.-punctuation-bracket {color: #9399b2}
.Boolean {color: #fab387}
.String {color: #a6e3a1}
.Operator {color: #89dceb}
.Special {color: #f5c2e7}
.Delimiter {color: #9399b2}
.-string-escape {color: #f5c2e7}
.Number {color: #fab387}
.-spell {}
.-property {color: #b4befe}
.Comment {color: #6c7086}
.-function-builtin {color: #fab387}
.-variable {color: #cdd6f4}
.Function {color: #89b4fa}
.DiagnosticVirtualTextHint {color: #94e2d5; background-color: #29313e}
.-variable-member {color: #b4befe}
</style><pre>
<span class="-variable">vim</span><span class="Delimiter">.</span><span class="-variable"><span class="-variable-member">api</span></span><span class="Delimiter">.</span><span class="-variable"><span class="-variable-member"><span class="Function">nvim_create_user_command</span></span></span><span class="-punctuation-bracket">(</span><span class="String">&quot;CodeHTML&quot;</span><span class="Delimiter">,</span> <span class="-keyword-function">function</span><span class="-punctuation-bracket">(</span><span class="-variable"><span class="-variable-parameter">opts</span></span><span class="-punctuation-bracket">)</span>
    <span class="Comment"><span class="-spell">-- Get the current buffer number</span></span>
    <span class="Keyword">local</span> <span class="-variable">bufnr</span> <span class="Operator">=</span> <span class="-variable">vim</span><span class="Delimiter">.</span><span class="-variable"><span class="-variable-member">api</span></span><span class="Delimiter">.</span><span class="-variable"><span class="-variable-member"><span class="Function">nvim_get_current_buf</span></span></span><span class="-punctuation-bracket">(</span><span class="-punctuation-bracket">)</span>

    <span class="Comment"><span class="-spell">-- save the selected lines</span></span>
    <span class="Keyword">local</span> <span class="-variable">start_line</span> <span class="Operator">=</span> <span class="-variable">opts</span><span class="Delimiter">.</span><span class="-variable"><span class="-variable-member">line1</span></span>
    <span class="Keyword">local</span> <span class="-variable">end_line</span> <span class="Operator">=</span> <span class="-variable">opts</span><span class="Delimiter">.</span><span class="-variable"><span class="-variable-member">line2</span></span>
    <span class="Keyword">local</span> <span class="-variable"><span class="Comment">last_line</span></span> <span class="Operator">=</span> <span class="-variable">vim</span><span class="Delimiter">.</span><span class="-variable"><span class="-variable-member">api</span></span><span class="Delimiter">.</span><span class="-variable"><span class="-variable-member"><span class="Function">nvim_buf_line_count</span></span></span><span class="-punctuation-bracket">(</span><span class="-variable">bufnr</span><span class="-punctuation-bracket">)</span>     <span class="DiagnosticVirtualTextHint">â– </span><span class="DiagnosticVirtualTextHint"> Unused local `last_line`.</span>

    <span class="Comment"><span class="-spell">-- convert into raw html</span></span>
    <span class="Keyword">local</span> <span class="-variable">html_output</span> <span class="Operator">=</span> <span class="-variable">tohtml</span><span class="Delimiter">.</span><span class="-variable"><span class="-variable-member"><span class="Function">tohtml</span></span></span><span class="-punctuation-bracket">(</span><span class="-constant-builtin">nil</span><span class="Delimiter">,</span> <span class="-punctuation-bracket"><span class="-constructor-lua">{</span></span> <span class="-variable"><span class="-property">number_lines</span></span> <span class="Operator">=</span> <span class="Boolean">false</span> <span class="-punctuation-bracket"><span class="-constructor-lua">}</span></span><span class="-punctuation-bracket">)</span>

    <span class="Comment"><span class="-spell">-- Create a new buffer</span></span>
    <span class="Keyword">local</span> <span class="-variable">new_buf</span> <span class="Operator">=</span> <span class="-variable">vim</span><span class="Delimiter">.</span><span class="-variable"><span class="-variable-member">api</span></span><span class="Delimiter">.</span><span class="-variable"><span class="-variable-member"><span class="Function">nvim_create_buf</span></span></span><span class="-punctuation-bracket">(</span><span class="Boolean">false</span><span class="Delimiter">,</span> <span class="Boolean">true</span><span class="-punctuation-bracket">)</span>

    <span class="Comment"><span class="-spell">-- Open a new split window and set the new buffer to it</span></span>
    <span class="-variable">vim</span><span class="Delimiter">.</span><span class="-variable"><span class="-variable-member">api</span></span><span class="Delimiter">.</span><span class="-variable"><span class="-variable-member"><span class="Function">nvim_command</span></span></span><span class="-punctuation-bracket">(</span><span class="String">&quot;<span class="Keyword">vsplit</span>&quot;</span><span class="-punctuation-bracket">)</span>
    <span class="-variable">vim</span><span class="Delimiter">.</span><span class="-variable"><span class="-variable-member">api</span></span><span class="Delimiter">.</span><span class="-variable"><span class="-variable-member"><span class="Function">nvim_win_set_buf</span></span></span><span class="-punctuation-bracket">(</span><span class="Number">0</span><span class="Delimiter">,</span> <span class="-variable">new_buf</span><span class="-punctuation-bracket">)</span>

    <span class="Comment"><span class="-spell">-- Set the buffer content to the HTML output</span></span>
    <span class="-variable">vim</span><span class="Delimiter">.</span><span class="-variable"><span class="-variable-member">api</span></span><span class="Delimiter">.</span><span class="-variable"><span class="-variable-member"><span class="Function">nvim_buf_set_lines</span></span></span><span class="-punctuation-bracket">(</span><span class="-variable">new_buf</span><span class="Delimiter">,</span> <span class="Number">0</span><span class="Delimiter">,</span> <span class="Operator">-</span><span class="Number">1</span><span class="Delimiter">,</span> <span class="Boolean">false</span><span class="Delimiter">,</span> <span class="-variable">html_output</span><span class="-punctuation-bracket">)</span>

    <span class="Comment"><span class="-spell">-- Optionally set the filetype to html for syntax highlighting</span></span>
    <span class="-variable">vim</span><span class="Delimiter">.</span><span class="-variable"><span class="-variable-member">bo</span></span><span class="-punctuation-bracket">[</span><span class="-variable">new_buf</span><span class="-punctuation-bracket">]</span><span class="Delimiter">.</span><span class="-variable"><span class="-variable-member">filetype</span></span> <span class="Operator">=</span> <span class="String">&quot;html&quot;</span>
    <span class="Comment"><span class="-spell">--</span></span>
    <span class="Comment"><span class="-spell">-- remove the css font and body setting, because it messes with the rest of the document</span></span>
    <span class="-variable">vim</span><span class="Delimiter">.</span><span class="-variable"><span class="-variable-member">api</span></span><span class="Delimiter">.</span><span class="-variable"><span class="-variable-member"><span class="Function">nvim_command</span></span></span><span class="-punctuation-bracket">(</span><span class="String">&quot;<span class="Delimiter">:</span>%s/^<span class="-string-escape">\\</span>* {<span class="Label">font-family: monospace}$/</span>&quot;</span><span class="-punctuation-bracket">)</span>
    <span class="Comment"><span class="-spell">-- vim.api.nvim_command(&quot;:%s/^body {.*/&quot;)</span></span>

    <span class="Comment"><span class="-spell">-- STYLES</span></span>
    <span class="Comment"><span class="-spell">-- get the style tag</span></span>
    <span class="-variable">vim</span><span class="Delimiter">.</span><span class="-variable"><span class="-variable-member">fn</span></span><span class="Delimiter">.</span><span class="-variable"><span class="-variable-member"><span class="Function">search</span></span></span><span class="-punctuation-bracket">(</span><span class="String">&quot;&lt;style&gt;&quot;</span><span class="Delimiter">,</span> <span class="String">&quot;w&quot;</span><span class="-punctuation-bracket">)</span>
    <span class="Comment"><span class="-spell">-- yank the style tag</span></span>
    <span class="-variable">vim</span><span class="Delimiter">.</span><span class="-variable"><span class="-variable-member"><span class="Function">cmd</span></span></span><span class="-punctuation-bracket">(</span><span class="String">'<span class="Keyword">normal</span><span class="Special">!</span><span class="Constant"> &quot;syat</span>'</span><span class="Delimiter">,</span> <span class="Boolean">true</span><span class="-punctuation-bracket">)</span>

    <span class="Comment"><span class="-spell">-- BODY</span></span>
    <span class="-variable">vim</span><span class="Delimiter">.</span><span class="-variable"><span class="-variable-member">fn</span></span><span class="Delimiter">.</span><span class="-variable"><span class="-variable-member"><span class="Function">search</span></span></span><span class="-punctuation-bracket">(</span><span class="String">&quot;pre&quot;</span><span class="Delimiter">,</span> <span class="String">&quot;w&quot;</span><span class="-punctuation-bracket">)</span>

    <span class="Comment"><span class="-spell">-- local command = start_line .. &quot;G&quot; .. &quot;V&quot; .. (end_line - start_line) .. &quot;j&quot; .. '&quot;by'</span></span>
    <span class="Keyword">local</span> <span class="-variable">command</span> <span class="Operator">=</span> <span class="-variable">start_line</span> <span class="Operator">..</span> <span class="String">&quot;jV&quot;</span> <span class="Operator">..</span> <span class="-punctuation-bracket">(</span><span class="-variable">end_line</span> <span class="Operator">-</span> <span class="-variable">start_line</span><span class="-punctuation-bracket">)</span> <span class="Operator">..</span> <span class="String">'j&quot;bygg'</span>
    <span class="-variable">vim</span><span class="Delimiter">.</span><span class="-variable"><span class="-variable-member"><span class="Function">cmd</span></span></span><span class="-punctuation-bracket">(</span><span class="String">&quot;normal! &quot;</span> <span class="Operator">..</span> <span class="-variable">command</span><span class="-punctuation-bracket">)</span>
    <span class="Comment"><span class="-spell">--</span></span>
    <span class="-variable">vim</span><span class="Delimiter">.</span><span class="-variable"><span class="-variable-member"><span class="Function">cmd</span></span></span><span class="-punctuation-bracket">(</span><span class="String">&quot;<span class="Keyword">normal</span><span class="Special">!</span><span class="Constant"> ggdG</span>&quot;</span><span class="-punctuation-bracket">)</span>
    <span class="Comment"><span class="-spell">--</span></span>
    <span class="-variable">vim</span><span class="Delimiter">.</span><span class="-variable"><span class="-variable-member"><span class="Function">cmd</span></span></span><span class="-punctuation-bracket">(</span><span class="String">'<span class="Keyword">normal</span><span class="Special">!</span><span class="Constant"> gg&quot;bP</span>'</span><span class="-punctuation-bracket">)</span>
    <span class="Comment"><span class="-spell">-- surround in pre tags</span></span>
    <span class="Comment"><span class="-spell">-- -- -- Get the current buffer</span></span>
    <span class="Keyword">local</span> <span class="-variable">this_buf</span> <span class="Operator">=</span> <span class="-variable">vim</span><span class="Delimiter">.</span><span class="-variable"><span class="-variable-member">api</span></span><span class="Delimiter">.</span><span class="-variable"><span class="-variable-member"><span class="Function">nvim_get_current_buf</span></span></span><span class="-punctuation-bracket">(</span><span class="-punctuation-bracket">)</span>
    <span class="-variable">vim</span><span class="Delimiter">.</span><span class="-variable"><span class="-variable-member">api</span></span><span class="Delimiter">.</span><span class="-variable"><span class="-variable-member"><span class="Function">nvim_buf_set_lines</span></span></span><span class="-punctuation-bracket">(</span><span class="-variable">this_buf</span><span class="Delimiter">,</span> <span class="Number">0</span><span class="Delimiter">,</span> <span class="Number">0</span><span class="Delimiter">,</span> <span class="Boolean">false</span><span class="Delimiter">,</span> <span class="-punctuation-bracket"><span class="-constructor-lua">{</span></span> <span class="String">&quot;&lt;pre&gt;&quot;</span> <span class="-punctuation-bracket"><span class="-constructor-lua">}</span></span><span class="-punctuation-bracket">)</span>
    <span class="Keyword">local</span> <span class="-variable">new_last_line</span> <span class="Operator">=</span> <span class="-variable">vim</span><span class="Delimiter">.</span><span class="-variable"><span class="-variable-member">api</span></span><span class="Delimiter">.</span><span class="-variable"><span class="-variable-member"><span class="Function">nvim_buf_line_count</span></span></span><span class="-punctuation-bracket">(</span><span class="-variable">this_buf</span><span class="-punctuation-bracket">)</span> <span class="Operator">-</span> <span class="Number">1</span>
    <span class="-variable">vim</span><span class="Delimiter">.</span><span class="-variable"><span class="-variable-member">api</span></span><span class="Delimiter">.</span><span class="-variable"><span class="-variable-member"><span class="Function">nvim_buf_set_lines</span></span></span><span class="-punctuation-bracket">(</span><span class="-variable">this_buf</span><span class="Delimiter">,</span> <span class="-variable">new_last_line</span><span class="Delimiter">,</span> <span class="-variable">new_last_line</span><span class="Delimiter">,</span> <span class="Boolean">false</span><span class="Delimiter">,</span> <span class="-punctuation-bracket"><span class="-constructor-lua">{</span></span> <span class="String">&quot;&lt;/pre&gt;&quot;</span> <span class="-punctuation-bracket"><span class="-constructor-lua">}</span></span><span class="-punctuation-bracket">)</span>

    <span class="-variable">vim</span><span class="Delimiter">.</span><span class="-variable"><span class="-variable-member"><span class="Function">cmd</span></span></span><span class="-punctuation-bracket">(</span><span class="String">'<span class="Keyword">normal</span><span class="Special">!</span><span class="Constant"> gg&quot;sP</span>'</span><span class="-punctuation-bracket">)</span>
    <span class="Comment"><span class="-spell">--</span></span>
    <span class="Comment"><span class="-spell">--<span class="Comment"><span class="-spell"> --</span></span></span></span>
    <span class="Comment"><span class="-spell">--</span></span>
    <span class="Comment"><span class="-spell">-- -- -- paste styles</span></span>
    <span class="Comment"><span class="-spell">-- -- vim.api.nvim_feedkeys('gg&quot;sP', &quot;n&quot;, true)</span></span>
<span class="-keyword-function">end</span><span class="Delimiter">,</span> <span class="-punctuation-bracket"><span class="-constructor-lua">{</span></span> <span class="-variable"><span class="-property">range</span></span> <span class="Operator">=</span> <span class="Boolean">true</span> <span class="-punctuation-bracket"><span class="-constructor-lua">}</span></span><span class="-punctuation-bracket">)</span>
</pre>

