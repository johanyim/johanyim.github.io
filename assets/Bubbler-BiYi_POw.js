import{i as S,e as B,c as M,g as _,m as j,a as m,b as T,d as q,f as H,r as P,h as w,j as A,k as L,l as O,n as W,o as F}from"./index-b2LIg75-.js";import{O as I,C as G,R as J}from"./OptionsColor-CMqUFD6Z.js";import{E as K}from"./ExternalInteractorBase-CIi3zRdK.js";class D{constructor(){this.distance=200,this.duration=.4,this.mix=!1}load(i){if(i){if(i.distance!==void 0&&(this.distance=i.distance),i.duration!==void 0&&(this.duration=i.duration),i.mix!==void 0&&(this.mix=i.mix),i.opacity!==void 0&&(this.opacity=i.opacity),i.color!==void 0){const e=S(this.color)?void 0:this.color;this.color=B(i.color,o=>I.create(e,o))}i.size!==void 0&&(this.size=i.size)}}}class N extends D{constructor(){super(),this.selectors=[]}load(i){super.load(i),i&&i.selectors!==void 0&&(this.selectors=i.selectors)}}class Q extends D{load(i){super.load(i),i&&(this.divs=B(i.divs,e=>{const o=new N;return o.load(e),o}))}}function E(p,i,e,o){if(i>=e){const s=p+(i-e)*o;return M(s,p,i)}else if(i<e){const s=p-(e-i)*o;return M(s,i,p)}}const v="bubble",g=0,U=0,X=2,R=1,k=1,Y=0,Z=0,C=.5,z=1;class ie extends K{constructor(i){super(i),this._clickBubble=()=>{var n;const e=this.container,o=e.actualOptions,s=e.interactivity.mouse.clickPosition,b=o.interactivity.modes.bubble;if(!b||!s)return;e.bubble||(e.bubble={});const t=e.retina.bubbleModeDistance;if(!t||t<g)return;const u=e.particles.quadTree.queryCircle(s,t,l=>this.isEnabled(l)),{bubble:r}=e;for(const l of u){if(!r.clicking)continue;l.bubble.inRange=!r.durationEnd;const c=l.getPosition(),f=_(c,s),d=(new Date().getTime()-(e.interactivity.mouse.clickTime??U))/j;d>b.duration&&(r.durationEnd=!0),d>b.duration*X&&(r.clicking=!1,r.durationEnd=!1);const h={bubbleObj:{optValue:e.retina.bubbleModeSize,value:l.bubble.radius},particlesObj:{optValue:m(l.options.size.value)*e.retina.pixelRatio,value:l.size.value},type:"size"};this._process(l,f,d,h);const a={bubbleObj:{optValue:b.opacity,value:l.bubble.opacity},particlesObj:{optValue:m(l.options.opacity.value),value:((n=l.opacity)==null?void 0:n.value)??R},type:"opacity"};this._process(l,f,d,a),!r.durationEnd&&f<=t?this._hoverBubbleColor(l,f):delete l.bubble.color}},this._hoverBubble=()=>{const e=this.container,o=e.interactivity.mouse.position,s=e.retina.bubbleModeDistance;if(!s||s<g||!o)return;const b=e.particles.quadTree.queryCircle(o,s,t=>this.isEnabled(t));for(const t of b){t.bubble.inRange=!0;const u=t.getPosition(),r=_(u,o),n=k-r/s;r<=s?n>=Z&&e.interactivity.status===T&&(this._hoverBubbleSize(t,n),this._hoverBubbleOpacity(t,n),this._hoverBubbleColor(t,n)):this.reset(t),e.interactivity.status===q&&this.reset(t)}},this._hoverBubbleColor=(e,o,s)=>{const b=this.container.actualOptions,t=s??b.interactivity.modes.bubble;if(t){if(!e.bubble.finalColor){const u=t.color;if(!u)return;const r=H(u);e.bubble.finalColor=P(r)}if(e.bubble.finalColor)if(t.mix){e.bubble.color=void 0;const u=e.getFillColor();e.bubble.color=u?w(A(u,e.bubble.finalColor,k-o,o)):e.bubble.finalColor}else e.bubble.color=e.bubble.finalColor}},this._hoverBubbleOpacity=(e,o,s)=>{var c,f;const b=this.container,t=b.actualOptions,u=(s==null?void 0:s.opacity)??((c=t.interactivity.modes.bubble)==null?void 0:c.opacity);if(!u)return;const r=e.options.opacity.value,n=((f=e.opacity)==null?void 0:f.value)??R,l=E(n,u,m(r),o);l!==void 0&&(e.bubble.opacity=l)},this._hoverBubbleSize=(e,o,s)=>{const b=this.container,t=s!=null&&s.size?s.size*b.retina.pixelRatio:b.retina.bubbleModeSize;if(t===void 0)return;const u=m(e.options.size.value)*b.retina.pixelRatio,r=e.size.value,n=E(r,t,u,o);n!==void 0&&(e.bubble.radius=n)},this._process=(e,o,s,b)=>{const t=this.container,u=b.bubbleObj.optValue,r=t.actualOptions,n=r.interactivity.modes.bubble;if(!n||u===void 0)return;const l=n.duration,c=t.retina.bubbleModeDistance,f=b.particlesObj.optValue,d=b.bubbleObj.value,h=b.particlesObj.value??Y,a=b.type;if(!(!c||c<g||u===f))if(t.bubble||(t.bubble={}),t.bubble.durationEnd)d&&(a==="size"&&delete e.bubble.radius,a==="opacity"&&delete e.bubble.opacity);else if(o<=c){if((d??h)!==u){const y=h-s*(h-u)/l;a==="size"&&(e.bubble.radius=y),a==="opacity"&&(e.bubble.opacity=y)}}else a==="size"&&delete e.bubble.radius,a==="opacity"&&delete e.bubble.opacity},this._singleSelectorHover=(e,o,s)=>{const b=this.container,t=document.querySelectorAll(o),u=b.actualOptions.interactivity.modes.bubble;!u||!t.length||t.forEach(r=>{const n=r,l=b.retina.pixelRatio,c={x:(n.offsetLeft+n.offsetWidth*C)*l,y:(n.offsetTop+n.offsetHeight*C)*l},f=n.offsetWidth*C*l,d=s.type==="circle"?new G(c.x,c.y,f):new J(n.offsetLeft*l,n.offsetTop*l,n.offsetWidth*l,n.offsetHeight*l),h=b.particles.quadTree.query(d,a=>this.isEnabled(a));for(const a of h){if(!d.contains(a.getPosition()))continue;a.bubble.inRange=!0;const x=u.divs,y=L(x,n);(!a.bubble.div||a.bubble.div!==n)&&(this.clear(a,e,!0),a.bubble.div=n),this._hoverBubbleSize(a,z,y),this._hoverBubbleOpacity(a,z,y),this._hoverBubbleColor(a,z,y)}})},i.bubble||(i.bubble={}),this.handleClickMode=e=>{e===v&&(i.bubble||(i.bubble={}),i.bubble.clicking=!0)}}clear(i,e,o){i.bubble.inRange&&!o||(delete i.bubble.div,delete i.bubble.opacity,delete i.bubble.radius,delete i.bubble.color)}init(){const i=this.container,e=i.actualOptions.interactivity.modes.bubble;e&&(i.retina.bubbleModeDistance=e.distance*i.retina.pixelRatio,e.size!==void 0&&(i.retina.bubbleModeSize=e.size*i.retina.pixelRatio))}interact(i){const e=this.container.actualOptions,o=e.interactivity.events,s=o.onHover,b=o.onClick,t=s.enable,u=s.mode,r=b.enable,n=b.mode,l=o.onDiv;t&&O(v,u)?this._hoverBubble():r&&O(v,n)?this._clickBubble():W(v,l,(c,f)=>this._singleSelectorHover(i,c,f))}isEnabled(i){const e=this.container,o=e.actualOptions,s=e.interactivity.mouse,b=((i==null?void 0:i.interactivity)??o.interactivity).events,{onClick:t,onDiv:u,onHover:r}=b,n=F(v,u);return n||r.enable&&s.position||t.enable&&s.clickPosition?O(v,r.mode)||O(v,t.mode)||n:!1}loadModeOptions(i,...e){i.bubble||(i.bubble=new Q);for(const o of e)i.bubble.load(o==null?void 0:o.bubble)}reset(i){i.bubble.inRange=!1}}export{ie as Bubbler};
