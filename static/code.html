<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>/home/johan/code/bga/warranty/backend/src/utils.rs</title>
<meta name="colorscheme" content="catppuccin-mocha"></meta>
<style>
* {font-family: monospace}
body {background-color: #11111b; color: #cdd6f4}
.-variable-parameter {color: #eba0ac}
.-keyword-function {color: #cba6f7}
.-keyword-return {color: #cba6f7}
.Type {color: #f9e2af}
.Keyword {color: #cba6f7}
.-constant-builtin {color: #fab387}
.Constant {color: #fab387}
.-module {color: #b4befe}
.-type-builtin {color: #f9e2af}
.DiagnosticUnderlineHint {text-decoration-line: underline}
.Delimiter {color: #9399b2}
.Boolean {color: #fab387}
.String {color: #a6e3a1}
.Operator {color: #89dceb}
.Special {color: #f5c2e7}
.DiagnosticVirtualTextHint {color: #94e2d5; background-color: #29313e}
.-variable-member {color: #b4befe}
.Conditional {color: #cba6f7}
.-spell {}
.Include {color: #cba6f7}
.Comment {color: #6c7086}
.-punctuation-bracket {color: #9399b2}
.-variable {color: #cdd6f4}
.Function {color: #89b4fa}
.-variable-builtin {color: #f38ba8}
.-function-macro {color: #94e2d5}
</style>
</head>
<body style="display: flex">
<pre>
<span class="Keyword"><span class="DiagnosticUnderlineHint">pu</span>b</span> <span class="Include">use</span> <span class="-module"><span class="-module">crate</span></span><span class="Delimiter">::</span><span class="-variable"><span class="-module">auth</span></span><span class="Delimiter">::</span><span class="-punctuation-bracket">{</span><span class="-variable"><span class="Type"><span class="Type">Admin</span></span></span><span class="Delimiter">,</span> <span class="-variable"><span class="Type"><span class="Type">Auth</span></span></span><span class="Delimiter">,</span> <span class="-variable"><span class="Type"><span class="Type">UserDetails</span></span></span><span class="-punctuation-bracket">}</span><span class="Delimiter">;</span>     <span class="DiagnosticVirtualTextHint">â– </span><span class="DiagnosticVirtualTextHint"> file not included in crate hierarchy</span>
<span class="Include">use</span> <span class="-variable"><span class="-module">actix_web</span></span><span class="Delimiter">::</span><span class="-variable"><span class="-module">error</span></span><span class="Delimiter">::</span><span class="-variable"><span class="Type"><span class="Type">ErrorInternalServerError</span></span></span> <span class="Include">as</span> <span class="-variable"><span class="Type"><span class="Type">InternalError</span></span></span><span class="Delimiter">;</span>
<span class="Include">use</span> <span class="-variable"><span class="-module">serde</span></span><span class="Delimiter">::</span><span class="-punctuation-bracket">{</span><span class="-variable"><span class="Type"><span class="Type">Deserialize</span></span></span><span class="Delimiter">,</span> <span class="-variable"><span class="Type"><span class="Type">Serialize</span></span></span><span class="-punctuation-bracket">}</span><span class="Delimiter">;</span>
<span class="Include">use</span> <span class="-variable"><span class="-module">tiberius</span></span><span class="Delimiter">::</span><span class="-variable"><span class="Type"><span class="Type">ToSql</span></span></span><span class="Delimiter">;</span>
<span class="Include">use</span> <span class="-variable"><span class="-module">tiberius_mappers</span></span><span class="Delimiter">::</span><span class="-variable"><span class="Type"><span class="Type">TryFromRow</span></span></span><span class="Delimiter">;</span>

<span class="Keyword">pub</span> <span class="Include">use</span> <span class="-variable"><span class="-module">log</span></span><span class="Delimiter">::</span><span class="-punctuation-bracket">{</span><span class="-variable">debug</span><span class="Delimiter">,</span> <span class="-variable">error</span><span class="Delimiter">,</span> <span class="-variable">info</span><span class="Delimiter">,</span> <span class="-variable">log_enabled</span><span class="Delimiter">,</span> <span class="-variable">trace</span><span class="Delimiter">,</span> <span class="-variable">warn</span><span class="Delimiter">,</span> <span class="-variable"><span class="Type"><span class="Type">Level</span></span></span><span class="-punctuation-bracket">}</span><span class="Delimiter">;</span>

<span class="Keyword">pub</span> <span class="Keyword">trait</span> <span class="Type">ClientExt</span> <span class="-punctuation-bracket">{</span>
    <span class="Special">#</span><span class="-punctuation-bracket">[</span><span class="-variable"><span class="-function-macro">allow</span></span><span class="-punctuation-bracket">(</span><span class="-variable">async_fn_in_trait</span><span class="-punctuation-bracket">)</span><span class="-punctuation-bracket">]</span>
    <span class="Keyword">async</span> <span class="-keyword-function">fn</span> <span class="-variable"><span class="Function">query_by</span></span><span class="Operator"><span class="-punctuation-bracket">&lt;</span></span><span class="Type">T</span><span class="Delimiter">:</span> <span class="Type">TryFromRow</span> <span class="Operator">+</span> <span class="Type">Serialize</span><span class="Operator"><span class="-punctuation-bracket">&gt;</span></span><span class="-punctuation-bracket">(</span>
        <span class="Operator">&amp;</span><span class="Keyword">mut</span> <span class="-variable-builtin">self</span><span class="Delimiter">,</span>
        <span class="-variable"><span class="-variable-parameter">query</span></span><span class="Delimiter">:</span> <span class="Operator">&amp;</span><span class="-type-builtin">str</span><span class="Delimiter">,</span>
        <span class="-variable"><span class="-variable-parameter">id</span></span><span class="Delimiter">:</span> <span class="Operator">&amp;</span><span class="Keyword">impl</span> <span class="Type">ToSql</span><span class="Delimiter">,</span>
    <span class="-punctuation-bracket">)</span> <span class="Delimiter">-&gt;</span> <span class="-variable"><span class="-module">actix_web</span></span><span class="Delimiter">::</span><span class="-variable"><span class="-module">error</span></span><span class="Delimiter">::</span><span class="Type">Result</span><span class="Operator"><span class="-punctuation-bracket">&lt;</span></span><span class="Type">T</span><span class="Operator"><span class="-punctuation-bracket">&gt;</span></span><span class="Delimiter">;</span>

    <span class="Special">#</span><span class="-punctuation-bracket">[</span><span class="-variable"><span class="-function-macro">allow</span></span><span class="-punctuation-bracket">(</span><span class="-variable">async_fn_in_trait</span><span class="-punctuation-bracket">)</span><span class="-punctuation-bracket">]</span>
    <span class="Keyword">async</span> <span class="-keyword-function">fn</span> <span class="-variable"><span class="Function">query_by_id_or_default</span></span><span class="Operator"><span class="-punctuation-bracket">&lt;</span></span><span class="Type">T</span><span class="Delimiter">:</span> <span class="Type">TryFromRow</span> <span class="Operator">+</span> <span class="Type">Default</span> <span class="Operator">+</span> <span class="Type">Serialize</span><span class="Operator"><span class="-punctuation-bracket">&gt;</span></span><span class="-punctuation-bracket">(</span>
        <span class="Operator">&amp;</span><span class="Keyword">mut</span> <span class="-variable-builtin">self</span><span class="Delimiter">,</span>
        <span class="-variable"><span class="-variable-parameter">query</span></span><span class="Delimiter">:</span> <span class="Operator">&amp;</span><span class="-type-builtin">str</span><span class="Delimiter">,</span>
        <span class="-variable"><span class="-variable-parameter">id</span></span><span class="Delimiter">:</span> <span class="Operator">&amp;</span><span class="Keyword">impl</span> <span class="Type">ToSql</span><span class="Delimiter">,</span>
    <span class="-punctuation-bracket">)</span> <span class="Delimiter">-&gt;</span> <span class="-variable"><span class="-module">actix_web</span></span><span class="Delimiter">::</span><span class="-variable"><span class="-module">error</span></span><span class="Delimiter">::</span><span class="Type">Result</span><span class="Operator"><span class="-punctuation-bracket">&lt;</span></span><span class="Type">T</span><span class="Operator"><span class="-punctuation-bracket">&gt;</span></span><span class="Delimiter">;</span>
    <span class="Special">#</span><span class="-punctuation-bracket">[</span><span class="-variable"><span class="-function-macro">allow</span></span><span class="-punctuation-bracket">(</span><span class="-variable">async_fn_in_trait</span><span class="-punctuation-bracket">)</span><span class="-punctuation-bracket">]</span>
    <span class="Keyword">async</span> <span class="-keyword-function">fn</span> <span class="-variable"><span class="Function">query_and_collect</span></span><span class="Operator"><span class="-punctuation-bracket">&lt;</span></span><span class="Type">T</span><span class="Delimiter">:</span> <span class="Type">TryFromRow</span><span class="Operator"><span class="-punctuation-bracket">&gt;</span></span><span class="-punctuation-bracket">(</span>
        <span class="Operator">&amp;</span><span class="Keyword">mut</span> <span class="-variable-builtin">self</span><span class="Delimiter">,</span>
        <span class="-variable"><span class="-variable-parameter">query</span></span><span class="Delimiter">:</span> <span class="Operator">&amp;</span><span class="-type-builtin">str</span><span class="Delimiter">,</span>
        <span class="-variable"><span class="-variable-parameter">params</span></span><span class="Delimiter">:</span> <span class="Operator">&amp;</span><span class="-punctuation-bracket">[</span><span class="Operator">&amp;</span><span class="Keyword">dyn</span> <span class="Type">ToSql</span><span class="-punctuation-bracket">]</span><span class="Delimiter">,</span>
    <span class="-punctuation-bracket">)</span> <span class="Delimiter">-&gt;</span> <span class="-variable"><span class="-module">actix_web</span></span><span class="Delimiter">::</span><span class="-variable"><span class="-module">error</span></span><span class="Delimiter">::</span><span class="Type">Result</span><span class="Operator"><span class="-punctuation-bracket">&lt;</span></span><span class="Type">Vec</span><span class="Operator"><span class="-punctuation-bracket">&lt;</span></span><span class="Type">T</span><span class="Operator"><span class="-punctuation-bracket">&gt;</span></span><span class="Operator"><span class="-punctuation-bracket">&gt;</span></span><span class="Delimiter">;</span>

    <span class="Special">#</span><span class="-punctuation-bracket">[</span><span class="-variable"><span class="-function-macro">allow</span></span><span class="-punctuation-bracket">(</span><span class="-variable">async_fn_in_trait</span><span class="-punctuation-bracket">)</span><span class="-punctuation-bracket">]</span>
    <span class="Keyword">async</span> <span class="-keyword-function">fn</span> <span class="-variable"><span class="Function">exists</span></span><span class="-punctuation-bracket">(</span><span class="Operator">&amp;</span><span class="Keyword">mut</span> <span class="-variable-builtin">self</span><span class="Delimiter">,</span> <span class="-variable"><span class="-variable-parameter">query</span></span><span class="Delimiter">:</span> <span class="Operator">&amp;</span><span class="-type-builtin">str</span><span class="Delimiter">,</span> <span class="-variable"><span class="-variable-parameter">id</span></span><span class="Delimiter">:</span> <span class="Operator">&amp;</span><span class="Keyword">impl</span> <span class="Type">ToSql</span><span class="-punctuation-bracket">)</span> <span class="Delimiter">-&gt;</span> <span class="-variable"><span class="-module">actix_web</span></span><span class="Delimiter">::</span><span class="-variable"><span class="-module">error</span></span><span class="Delimiter">::</span><span class="Type">Result</span><span class="Operator"><span class="-punctuation-bracket">&lt;</span></span><span class="-type-builtin">bool</span><span class="Operator"><span class="-punctuation-bracket">&gt;</span></span><span class="Delimiter">;</span>
<span class="-punctuation-bracket">}</span>

<span class="Comment"><span class="-spell">//deadpool_tiberius::deadpool::managed::Object&lt;deadpool_tiberius::MAnager&gt;</span></span>

<span class="Keyword">impl</span> <span class="Type">ClientExt</span> <span class="Keyword">for</span> <span class="-variable"><span class="-module">deadpool_tiberius</span></span><span class="Delimiter">::</span><span class="Type">Client</span> <span class="-punctuation-bracket">{</span>
    <span class="Comment"><span class="-spell">// deadpool::managed::Object&lt;deadpool_tiberius::Manager&gt; {</span></span>
    <span class="Keyword">async</span> <span class="-keyword-function">fn</span> <span class="-variable"><span class="Function">query_by</span></span><span class="Operator"><span class="-punctuation-bracket">&lt;</span></span><span class="Type">T</span><span class="Delimiter">:</span> <span class="Type">TryFromRow</span> <span class="Operator">+</span> <span class="Type">Serialize</span><span class="Operator"><span class="-punctuation-bracket">&gt;</span></span><span class="-punctuation-bracket">(</span>
        <span class="Operator">&amp;</span><span class="Keyword">mut</span> <span class="-variable-builtin">self</span><span class="Delimiter">,</span>
        <span class="-variable"><span class="-variable-parameter">query</span></span><span class="Delimiter">:</span> <span class="Operator">&amp;</span><span class="-type-builtin">str</span><span class="Delimiter">,</span>
        <span class="-variable"><span class="-variable-parameter">id</span></span><span class="Delimiter">:</span> <span class="Operator">&amp;</span><span class="Keyword">impl</span> <span class="Type">ToSql</span><span class="Delimiter">,</span>
    <span class="-punctuation-bracket">)</span> <span class="Delimiter">-&gt;</span> <span class="-variable"><span class="-module">actix_web</span></span><span class="Delimiter">::</span><span class="-variable"><span class="-module">error</span></span><span class="Delimiter">::</span><span class="Type">Result</span><span class="Operator"><span class="-punctuation-bracket">&lt;</span></span><span class="Type">T</span><span class="Operator"><span class="-punctuation-bracket">&gt;</span></span> <span class="-punctuation-bracket">{</span>
        <span class="Keyword">let</span> <span class="-variable">result</span> <span class="Operator">=</span> <span class="-variable-builtin">self</span>
            <span class="Delimiter">.</span><span class="-variable-member"><span class="Function">query</span></span><span class="-punctuation-bracket">(</span><span class="-variable">query</span><span class="Delimiter">,</span> <span class="Operator">&amp;</span><span class="-punctuation-bracket">[</span><span class="-variable">id</span><span class="-punctuation-bracket">]</span><span class="-punctuation-bracket">)</span>
            <span class="Delimiter">.</span><span class="Keyword">await</span>
            <span class="Delimiter">.</span><span class="-variable-member"><span class="Function">map_err</span></span><span class="-punctuation-bracket">(</span><span class="-variable"><span class="Type">InternalError</span></span><span class="-punctuation-bracket">)</span><span class="Operator">?</span>
            <span class="Delimiter">.</span><span class="-variable-member"><span class="Function">into_row</span></span><span class="-punctuation-bracket">(</span><span class="-punctuation-bracket">)</span>
            <span class="Delimiter">.</span><span class="Keyword">await</span>
            <span class="Delimiter">.</span><span class="-variable-member"><span class="Function">map_err</span></span><span class="-punctuation-bracket">(</span><span class="-variable"><span class="Type">InternalError</span></span><span class="-punctuation-bracket">)</span><span class="Operator">?</span><span class="Delimiter">;</span>

        <span class="Keyword">let</span> <span class="-variable">result</span> <span class="Operator">=</span> <span class="Conditional">match</span> <span class="-variable">result</span> <span class="-punctuation-bracket">{</span>
            <span class="-variable"><span class="Type"><span class="-constant-builtin">Some</span></span></span><span class="-punctuation-bracket">(</span><span class="-variable">row</span><span class="-punctuation-bracket">)</span> <span class="Delimiter">=&gt;</span> <span class="-variable">row</span><span class="Delimiter">,</span>
            <span class="Comment"><span class="-spell">// None =&gt; return Ok(T::default()),</span></span>
            <span class="-variable"><span class="Type"><span class="Constant"><span class="-constant-builtin">None</span></span></span></span> <span class="Delimiter">=&gt;</span> <span class="-keyword-return">return</span> <span class="-variable"><span class="Type"><span class="Function"><span class="-constant-builtin">Err</span></span></span></span><span class="-punctuation-bracket">(</span><span class="-variable"><span class="Type"><span class="Function">InternalError</span></span></span><span class="-punctuation-bracket">(</span><span class="-variable"><span class="-function-macro">format</span></span><span class="Operator"><span class="-function-macro">!</span></span><span class="-punctuation-bracket"><span class="-punctuation-bracket">(</span></span><span class="String"><span class="String">&quot;No result for id&quot;</span></span><span class="-punctuation-bracket"><span class="-punctuation-bracket">)</span></span><span class="-punctuation-bracket">)</span><span class="-punctuation-bracket">)</span><span class="Delimiter">,</span>
        <span class="-punctuation-bracket">}</span><span class="Delimiter">;</span>
        <span class="-variable"><span class="Type"><span class="Function"><span class="-constant-builtin">Ok</span></span></span></span><span class="-punctuation-bracket">(</span><span class="-variable"><span class="Type"><span class="Constant"><span class="-module"><span class="Type">T</span></span></span></span></span><span class="Delimiter">::</span><span class="-variable"><span class="Function">try_from_row</span></span><span class="-punctuation-bracket">(</span><span class="-variable">result</span><span class="-punctuation-bracket">)</span><span class="Delimiter">.</span><span class="-variable-member"><span class="Function">map_err</span></span><span class="-punctuation-bracket">(</span><span class="-variable"><span class="Type">InternalError</span></span><span class="-punctuation-bracket">)</span><span class="Operator">?</span><span class="-punctuation-bracket">)</span>
    <span class="-punctuation-bracket">}</span>

    <span class="Keyword">async</span> <span class="-keyword-function">fn</span> <span class="-variable"><span class="Function">query_by_id_or_default</span></span><span class="Operator"><span class="-punctuation-bracket">&lt;</span></span><span class="Type">T</span><span class="Delimiter">:</span> <span class="Type">TryFromRow</span> <span class="Operator">+</span> <span class="Type">Default</span> <span class="Operator">+</span> <span class="Type">Serialize</span><span class="Operator"><span class="-punctuation-bracket">&gt;</span></span><span class="-punctuation-bracket">(</span>
        <span class="Operator">&amp;</span><span class="Keyword">mut</span> <span class="-variable-builtin">self</span><span class="Delimiter">,</span>
        <span class="-variable"><span class="-variable-parameter">query</span></span><span class="Delimiter">:</span> <span class="Operator">&amp;</span><span class="-type-builtin">str</span><span class="Delimiter">,</span>
        <span class="-variable"><span class="-variable-parameter">id</span></span><span class="Delimiter">:</span> <span class="Operator">&amp;</span><span class="Keyword">impl</span> <span class="Type">ToSql</span><span class="Delimiter">,</span>
    <span class="-punctuation-bracket">)</span> <span class="Delimiter">-&gt;</span> <span class="-variable"><span class="-module">actix_web</span></span><span class="Delimiter">::</span><span class="-variable"><span class="-module">error</span></span><span class="Delimiter">::</span><span class="Type">Result</span><span class="Operator"><span class="-punctuation-bracket">&lt;</span></span><span class="Type">T</span><span class="Operator"><span class="-punctuation-bracket">&gt;</span></span> <span class="-punctuation-bracket">{</span>
        <span class="Keyword">let</span> <span class="-variable">result</span> <span class="Operator">=</span> <span class="-variable-builtin">self</span>
            <span class="Delimiter">.</span><span class="-variable-member"><span class="Function">query</span></span><span class="-punctuation-bracket">(</span><span class="-variable">query</span><span class="Delimiter">,</span> <span class="Operator">&amp;</span><span class="-punctuation-bracket">[</span><span class="-variable">id</span><span class="-punctuation-bracket">]</span><span class="-punctuation-bracket">)</span>
            <span class="Delimiter">.</span><span class="Keyword">await</span>
            <span class="Delimiter">.</span><span class="-variable-member"><span class="Function">map_err</span></span><span class="-punctuation-bracket">(</span><span class="-variable"><span class="Type">InternalError</span></span><span class="-punctuation-bracket">)</span><span class="Operator">?</span>
            <span class="Delimiter">.</span><span class="-variable-member"><span class="Function">into_row</span></span><span class="-punctuation-bracket">(</span><span class="-punctuation-bracket">)</span>
            <span class="Delimiter">.</span><span class="Keyword">await</span>
            <span class="Delimiter">.</span><span class="-variable-member"><span class="Function">map_err</span></span><span class="-punctuation-bracket">(</span><span class="-variable"><span class="Type">InternalError</span></span><span class="-punctuation-bracket">)</span><span class="Operator">?</span><span class="Delimiter">;</span>

        <span class="Keyword">let</span> <span class="-variable">result</span> <span class="Operator">=</span> <span class="Conditional">match</span> <span class="-variable">result</span> <span class="-punctuation-bracket">{</span>
            <span class="-variable"><span class="Type"><span class="-constant-builtin">Some</span></span></span><span class="-punctuation-bracket">(</span><span class="-variable">row</span><span class="-punctuation-bracket">)</span> <span class="Delimiter">=&gt;</span> <span class="-variable">row</span><span class="Delimiter">,</span>
            <span class="-variable"><span class="Type"><span class="Constant"><span class="-constant-builtin">None</span></span></span></span> <span class="Delimiter">=&gt;</span> <span class="-keyword-return">return</span> <span class="-variable"><span class="Type"><span class="Function"><span class="-constant-builtin">Ok</span></span></span></span><span class="-punctuation-bracket">(</span><span class="-variable"><span class="Type"><span class="Constant"><span class="-module"><span class="Type">T</span></span></span></span></span><span class="Delimiter">::</span><span class="-variable"><span class="Function">default</span></span><span class="-punctuation-bracket">(</span><span class="-punctuation-bracket">)</span><span class="-punctuation-bracket">)</span><span class="Delimiter">,</span>
        <span class="-punctuation-bracket">}</span><span class="Delimiter">;</span>
        <span class="-variable"><span class="Type"><span class="Function"><span class="-constant-builtin">Ok</span></span></span></span><span class="-punctuation-bracket">(</span><span class="-variable"><span class="Type"><span class="Constant"><span class="-module"><span class="Type">T</span></span></span></span></span><span class="Delimiter">::</span><span class="-variable"><span class="Function">try_from_row</span></span><span class="-punctuation-bracket">(</span><span class="-variable">result</span><span class="-punctuation-bracket">)</span><span class="Delimiter">.</span><span class="-variable-member"><span class="Function">map_err</span></span><span class="-punctuation-bracket">(</span><span class="-variable"><span class="Type">InternalError</span></span><span class="-punctuation-bracket">)</span><span class="Operator">?</span><span class="-punctuation-bracket">)</span>
    <span class="-punctuation-bracket">}</span>
    <span class="Keyword">async</span> <span class="-keyword-function">fn</span> <span class="-variable"><span class="Function">query_and_collect</span></span><span class="Operator"><span class="-punctuation-bracket">&lt;</span></span><span class="Type">T</span><span class="Delimiter">:</span> <span class="Type">TryFromRow</span><span class="Operator"><span class="-punctuation-bracket">&gt;</span></span><span class="-punctuation-bracket">(</span>
        <span class="Operator">&amp;</span><span class="Keyword">mut</span> <span class="-variable-builtin">self</span><span class="Delimiter">,</span>
        <span class="-variable"><span class="-variable-parameter">query</span></span><span class="Delimiter">:</span> <span class="Operator">&amp;</span><span class="-type-builtin">str</span><span class="Delimiter">,</span>
        <span class="-variable"><span class="-variable-parameter">params</span></span><span class="Delimiter">:</span> <span class="Operator">&amp;</span><span class="-punctuation-bracket">[</span><span class="Operator">&amp;</span><span class="Keyword">dyn</span> <span class="Type">ToSql</span><span class="-punctuation-bracket">]</span><span class="Delimiter">,</span>
    <span class="-punctuation-bracket">)</span> <span class="Delimiter">-&gt;</span> <span class="-variable"><span class="-module">actix_web</span></span><span class="Delimiter">::</span><span class="-variable"><span class="-module">error</span></span><span class="Delimiter">::</span><span class="Type">Result</span><span class="Operator"><span class="-punctuation-bracket">&lt;</span></span><span class="Type">Vec</span><span class="Operator"><span class="-punctuation-bracket">&lt;</span></span><span class="Type">T</span><span class="Operator"><span class="-punctuation-bracket">&gt;</span></span><span class="Operator"><span class="-punctuation-bracket">&gt;</span></span> <span class="-punctuation-bracket">{</span>
        <span class="Keyword">let</span> <span class="-variable">rows</span> <span class="Operator">=</span> <span class="-variable-builtin">self</span>
            <span class="Delimiter">.</span><span class="-variable-member"><span class="Function">query</span></span><span class="-punctuation-bracket">(</span><span class="-variable">query</span><span class="Delimiter">,</span> <span class="-variable">params</span><span class="-punctuation-bracket">)</span>
            <span class="Delimiter">.</span><span class="Keyword">await</span>
            <span class="Delimiter">.</span><span class="-variable-member"><span class="Function">map_err</span></span><span class="-punctuation-bracket">(</span><span class="-variable"><span class="Type">InternalError</span></span><span class="-punctuation-bracket">)</span><span class="Operator">?</span>
            <span class="Delimiter">.</span><span class="-variable-member"><span class="Function">into_first_result</span></span><span class="-punctuation-bracket">(</span><span class="-punctuation-bracket">)</span>
            <span class="Delimiter">.</span><span class="Keyword">await</span>
            <span class="Delimiter">.</span><span class="-variable-member"><span class="Function">map_err</span></span><span class="-punctuation-bracket">(</span><span class="-variable"><span class="Type">InternalError</span></span><span class="-punctuation-bracket">)</span><span class="Operator">?</span><span class="Delimiter">;</span>

        <span class="Keyword">let</span> <span class="-variable">products</span> <span class="Operator">=</span> <span class="-variable">rows</span>
            <span class="Delimiter">.</span><span class="-variable-member"><span class="Function">into_iter</span></span><span class="-punctuation-bracket">(</span><span class="-punctuation-bracket">)</span>
            <span class="Delimiter">.</span><span class="-variable-member"><span class="Function">map</span></span><span class="-punctuation-bracket">(</span><span class="-variable"><span class="Type"><span class="Constant"><span class="-module"><span class="Type">T</span></span></span></span></span><span class="Delimiter">::</span><span class="-variable">try_from_row</span><span class="-punctuation-bracket">)</span>
            <span class="Delimiter">.</span><span class="-variable-member"><span class="Function">collect</span></span><span class="Delimiter">::</span><span class="Operator"><span class="-punctuation-bracket">&lt;</span></span><span class="Type">Result</span><span class="Operator"><span class="-punctuation-bracket">&lt;</span></span><span class="Type">Vec</span><span class="Operator"><span class="-punctuation-bracket">&lt;</span></span><span class="Type">T</span><span class="Operator"><span class="-punctuation-bracket">&gt;</span></span><span class="Delimiter">,</span> <span class="Type">_</span><span class="Operator"><span class="-punctuation-bracket">&gt;</span></span><span class="Operator"><span class="-punctuation-bracket">&gt;</span></span><span class="-punctuation-bracket">(</span><span class="-punctuation-bracket">)</span>
            <span class="Delimiter">.</span><span class="-variable-member"><span class="Function">map_err</span></span><span class="-punctuation-bracket">(</span><span class="-variable"><span class="Type">InternalError</span></span><span class="-punctuation-bracket">)</span><span class="Operator">?</span><span class="Delimiter">;</span>

        <span class="-variable"><span class="Type"><span class="Function"><span class="-constant-builtin">Ok</span></span></span></span><span class="-punctuation-bracket">(</span><span class="-variable">products</span><span class="-punctuation-bracket">)</span>
    <span class="-punctuation-bracket">}</span>

    <span class="Keyword">async</span> <span class="-keyword-function">fn</span> <span class="-variable"><span class="Function">exists</span></span><span class="-punctuation-bracket">(</span><span class="Operator">&amp;</span><span class="Keyword">mut</span> <span class="-variable-builtin">self</span><span class="Delimiter">,</span> <span class="-variable"><span class="-variable-parameter">query</span></span><span class="Delimiter">:</span> <span class="Operator">&amp;</span><span class="-type-builtin">str</span><span class="Delimiter">,</span> <span class="-variable"><span class="-variable-parameter">id</span></span><span class="Delimiter">:</span> <span class="Operator">&amp;</span><span class="Keyword">impl</span> <span class="Type">ToSql</span><span class="-punctuation-bracket">)</span> <span class="Delimiter">-&gt;</span> <span class="-variable"><span class="-module">actix_web</span></span><span class="Delimiter">::</span><span class="-variable"><span class="-module">error</span></span><span class="Delimiter">::</span><span class="Type">Result</span><span class="Operator"><span class="-punctuation-bracket">&lt;</span></span><span class="-type-builtin">bool</span><span class="Operator"><span class="-punctuation-bracket">&gt;</span></span> <span class="-punctuation-bracket">{</span>
        <span class="Keyword">let</span> <span class="-variable">result</span> <span class="Operator">=</span> <span class="-variable-builtin">self</span>
            <span class="Delimiter">.</span><span class="-variable-member"><span class="Function">query</span></span><span class="-punctuation-bracket">(</span><span class="-variable">query</span><span class="Delimiter">,</span> <span class="Operator">&amp;</span><span class="-punctuation-bracket">[</span><span class="-variable">id</span><span class="-punctuation-bracket">]</span><span class="-punctuation-bracket">)</span>
            <span class="Delimiter">.</span><span class="Keyword">await</span>
            <span class="Delimiter">.</span><span class="-variable-member"><span class="Function">map_err</span></span><span class="-punctuation-bracket">(</span><span class="-variable"><span class="Type">InternalError</span></span><span class="-punctuation-bracket">)</span><span class="Operator">?</span>
            <span class="Delimiter">.</span><span class="-variable-member"><span class="Function">into_row</span></span><span class="-punctuation-bracket">(</span><span class="-punctuation-bracket">)</span>
            <span class="Delimiter">.</span><span class="Keyword">await</span>
            <span class="Delimiter">.</span><span class="-variable-member"><span class="Function">map_err</span></span><span class="-punctuation-bracket">(</span><span class="-variable"><span class="Type">InternalError</span></span><span class="-punctuation-bracket">)</span><span class="Operator">?</span><span class="Delimiter">;</span>
        <span class="Conditional">match</span> <span class="-variable">result</span> <span class="-punctuation-bracket">{</span>
            <span class="-variable"><span class="Type"><span class="-constant-builtin">Some</span></span></span><span class="-punctuation-bracket">(</span><span class="-variable-builtin">_</span><span class="-punctuation-bracket">)</span> <span class="Delimiter">=&gt;</span> <span class="-variable"><span class="Type"><span class="Function"><span class="-constant-builtin">Ok</span></span></span></span><span class="-punctuation-bracket">(</span><span class="Boolean">true</span><span class="-punctuation-bracket">)</span><span class="Delimiter">,</span>
            <span class="-variable"><span class="Type"><span class="Constant"><span class="-constant-builtin">None</span></span></span></span> <span class="Delimiter">=&gt;</span> <span class="-variable"><span class="Type"><span class="Function"><span class="-constant-builtin">Ok</span></span></span></span><span class="-punctuation-bracket">(</span><span class="Boolean">false</span><span class="-punctuation-bracket">)</span><span class="Delimiter">,</span>
        <span class="-punctuation-bracket">}</span>
    <span class="-punctuation-bracket">}</span>
<span class="-punctuation-bracket">}</span>

<span class="Special">#</span><span class="-punctuation-bracket">[</span><span class="-variable"><span class="-function-macro">derive</span></span><span class="-punctuation-bracket">(</span><span class="-variable"><span class="Type">Clone</span></span><span class="Delimiter">,</span> <span class="-variable"><span class="Type">Default</span></span><span class="Delimiter">,</span> <span class="-variable"><span class="Type">Deserialize</span></span><span class="Delimiter">,</span> <span class="-variable"><span class="Type">Serialize</span></span><span class="Delimiter">,</span> <span class="-variable"><span class="Type">Debug</span></span><span class="Delimiter">,</span> <span class="-variable"><span class="Type">TryFromRow</span></span><span class="-punctuation-bracket">)</span><span class="-punctuation-bracket">]</span>
<span class="Keyword">pub</span> <span class="Keyword">struct</span> <span class="Type">Id</span> <span class="-punctuation-bracket">{</span>
    <span class="Keyword">pub</span> <span class="-variable-member">id</span><span class="Delimiter">:</span> <span class="-type-builtin">i64</span><span class="Delimiter">,</span>
<span class="-punctuation-bracket">}</span>

</pre>
</body>
</html>
